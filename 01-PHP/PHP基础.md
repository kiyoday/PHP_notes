## PHP引用变量

### 引用变量的概念及定义

- 概念：意味着用不同的名字访问同一个变量内容
- 定义方式：&符号

### PHP引用变量的原理

- 工作原理：引用一个变量相当于两个变量指向一个地址，改一个全改

- **unset( )只会取消引用、不会销毁空间**🌌

  ```php
  $a = range(0,1000);
  var_dump(memory_get_usage());
  
  $b = $a;//a、b指向同一地址
  var_dump(memory_get_usage());//没有开辟
  
  $a = range(0,1000);	//写实复制会新开辟空间，a、b指向不同地址
  var_dump(memory_get_usage());//开辟了
  ```

  <img src="C:\Users\12605\Desktop\PHP_notes\.img\bDYMXIkN29SJZAU.png" alt="image-20200603232126412" style="zoom: 50%;" />

- 引用传递

  ```php
  $a = 'hello';
  $b = &$a; 	//不会开辟新的空间
  $a = 'world';//a、b指向同一地址 不会开辟新空间
  
  unset($b);	//$a还存在
  xdebug_debug_zval($a);//查看容器
  ```

  <img src="C:\Users\12605\Desktop\PHP_notes\.img\SQuMOFRkK3BqUcf.png" alt="image-20200603232402713" style="zoom: 33%;" />

- **对象本身就是引用传递**

  ```php
  class Person{
      public $name = "zhangsan";
  }
  $p1 = new Person;
  $p2 = $p1;
  
  $p2->name="lisi";
  ```

  ![image-20200603232719560](C:\Users\12605\AppData\Roaming\Typora\typora-user-images\image-20200603232719560.png)

- foreach($data as $key => $val) {循环体}  循环遍历数组

  ```php
  $data=['a','b','c'] ;
  foreach($data as $key => $val)
  {
  	$val = &$data [$key];
  }
  ```

  <img src="https://i.loli.net/2020/06/04/Scywg24Balj5YO7.png" alt="image-20200603233135674" style="zoom:50%;" />

## 常量及数据类型

### 字符串定义方式及区别

- 定义方式

  - 单引号

  - 双引号

    ```php
    $str = 'abcdef $a g';
    $str ='abcdef '{$a}'g h”
    ```

  - heredoc和newdoc

    ```php
    echo <<<EOF
            <h1>我的第一个标题</h1>
            <p>我的第一个段落。</p>
    EOF;
    // 结束需要独立一行且前后不能空格
    ```

    

- 区别

  - 单引号

  	- 单引号不能解析变量，效率高于双引号
  	- 变量和变量、变量和字符串、字符串和字符串之间可以用“ . ”连接
  	- 单引号**<u>不能解析转义字符</u>**，只能解析单引号和反斜线本身

  - 双引号

  	- 双引号**可以解析变量**，变量可以使用特殊字符和“{}”包含
  	- 双引号可以解析所有**转义字符**
  	- 也可以使用“ . ”来连接

  - Heredoc和Newdoc

  	- Heredoc类似于双引号
  	- Newdoc类似于单引号
  	- 两者都用来处理大文本

### 数据类型

- 整型
- 浮点✨

  **浮点类型不能用于比较**中，尤其是相等（计算器计算时会转成二进制造成损耗）
   ![image-20200603190715659](C:\Users\12605\Desktop\PHP_notes\.img\Uat7yR6B4VCYEu9.png)

- 字符串
- 布尔型

  FALSE的七种情况：💡

  整型0、浮点0.0、布尔false，空字符串、0字符串、空数组、NULL

- 数组

  - **超全局数组**🧵

    $\_GLOBALS、$\_GET、$\_POST、$\_REQUEST、

    $\_SESSION、$\_COOKIE、$\_SERVER、$\_FILES、$\_ENV

    ```php
    $_SERVER['REMOTE_ADDR'] //当前浏览用户的IP地址
    $_SERVER['SERVER_ADDR'] //当前运行脚本所在服务器的IP地址
    ```

- 对象

- 空值NULL

  - 三种情况💡

    直接赋值为NULL、未定义的变量、unset销毁的变量

- 资源

  

### 常量

- 定义const/define

	  ```php
	const pi = 3.14
	define('pi',3.14);
	```
	
	- const更快（是语言结构）define是**函数**💡
	
	- define不能用于**类常量**的定义，但const可以
	
	- 常量一经定义，不能被修改，不能被删除
	
- 预定义常量 魔术常量🎭

  ```php
  __LINE__;	//文件中的当前行号
  __FILE__;	//文件的完整路径和文件名
  __DIR__;	//文件所在的目录
  __FUNCTION__;//函数名称
  __CLASS__ ;  //类的名称
  __METHOD__; //类的方法名
  __NAMESPACE__; //当前命名空间的名称
  ```


## 运算符

### 错误控制符@

- @：当将其放置在一个PHP表达式之前，该表达式可能<u>产生的任何错误信息都被忽略掉</u>

  ```php
  foo();
  @foo();
  ```

  

### 所有运算符

- 运算符优先级

  <img src="C:\Users\12605\Desktop\PHP_notes\.img\mesVN1pUHhoajiz.png" alt="image-20200604100643560" style="zoom: 50%;" />

- 比较运算符

  - ==与===的区别

    <u>==用于数值，===还用于数据类型</u>❤

  - 等值判断（FALSE的七种情况）

- 递增递减运算符

	- 递增/递减运算符不影响布尔值
	- 递减NULL值没有效果
	- 递增NULL值为1
	- 递增递减在前先运算后返回，反之先返回再运算

- 逻辑运算符

	- 短路作用

	- ||和&&与or和and的优先级不同
	
	  <img src="C:\Users\12605\Desktop\PHP_notes\.img\ytwKYoLQnusPRe2.png" alt="image-20200604101011931" style="zoom:50%;" />

## 流程控制

### 遍历数组的三种方式及各自区别

- for循环

	- 只能遍历**索引数组**

- foreach循环

	- 可以遍历**索引和关联**数组
	- 会对数组进行reset( ) 

- while、list( )、each( )组合循环

	- 可以遍历索引和关联数组
	- 不会reset( )重置指针

### 分支结构

- if......elseif

- switch..case...

	- 不会一层一层判断

## 自定义函数及内部函数

### 变量的作用域和静态变量

- 变量的作用域  也称变量的范围

  - 局部变量和全局变量

  	- global关键字
  	- $GLOBALS及其他超全局数组

- **静态变量**

	静态变量仅在局部函数域中存在，但当程序执行离开此作用域时其值并不会消失。
	
	**static关键字**🔍
	
	- 仅初始化一次
	- 初始化时需要赋值
	- 每次执行函数该值会保留
	- static修饰的变量是局部的，仅在函数内部有效
	- 可以记录函数的调用次数，从而可以在某些条件下终止递归

### 外部文件的导入

|            |        require         |        include         |
| :--------: | :--------------------: | :--------------------: |
| 没有文件时 | 发出致命错误，停止运行 |   发出警告，继续运行   |
| 加上_once  |   会检查是否被包含=>   | 如果包含则不会再次包含 |

### 函数的返回值及引用返回

- 函数的返回值

  | 函数的返回值                                   |
  | ---------------------------------------------- |
  | 值通过使用可选的返回语句(return )返回          |
  | 可以返回包括数组和对象的任意类型               |
  | 返回语句会终止函数执行，将控制权交回函数调用处 |
  | 省略return则返回值为NULL                       |
  | 不可以有多个返回值                             |

- 引用返回

### 系统内置函数🏆

- **时期日期函数**
  - date()	格式化本地日期和时间（farmat, timestamp）
  - time()	返回当前时间的 Unix 时间戳。
  - mktime()   返回日期的 Unix 时间戳
  - strtotime()	将任何英文文本的日期或时间描述解析为 Unix 时间戳
  - microtime()	返回当前时间的微秒数。
  - date_default_timezone_set()	设置由所有的 Date/Time 函数使用的默认时区。

- IP处理函数

	- ip2long — 将 IPV4 的字符串互联网协议转换成长整型数字
	- long2ip — 将长整型转化为字符串形式带点的互联网标准格式地址（IPV4）

- 打印处理

  | 函数名     | 功能                                                         |
  | ---------- | ------------------------------------------------------------ |
  | echo       | 输出一个或**多个字**符串（可以打印多个变量，没有返回值，速度快） |
  | print      | 只能输出**一个字符串**，且返回值总为1                        |
  | print_r    | 打印复合类型、如数组和对象                                   |
  | printf     | 输出格式化字符串（根据格式输出）                             |
  | sprintf    | 返回格式化的字符串返回不输出                                 |
  | var_dump   | 打印变量的相关信息（打印类型**用于debug**）                  |
  | var_export | 输出或返回一个变量的字符串表示（符合语法结构**可以直接使用**） |

- 序列化及反序列化

	- serialize — 产生一个可存储的值的表示
	- unserialize — 从已存储的表示中创建 PHP 的值

- **字符串处理函数**🎈

  | 函数名        | 功能                                       |
  | ------------- | ------------------------------------------ |
  | strlen        | 获取字符串长度                             |
  | implode       | 将一个一维数组的值`转化为`字符串           |
  | explode       | 使用一个字符串分割另一个字符串             |
  | strrev        | 反转字符串                                 |
  | strstr        | 查找字符串的首次出现                       |
  | trim          | 去除字符串首尾处的空白字符（或者其他字符） |
  | ltrim         | 删除字符串开头的空白字符（或其他字符）     |
  | rtrim         | 删除字符串末端的空白字符（或者其他字符）   |
  | number_format | 以千位分隔符方式格式化一个数字（处理美元） |

  

- **数组处理函数**💎

  | 函数名          | 功能                                     |
  | --------------- | ---------------------------------------- |
  | sort            | 对数组排序                               |
  | count           | 计算数组中的单元数目，或对象中的属性个数 |
  | array_keys      | 返回数组中部分的或所有的键名             |
  | array_values    | 返回数组中所有的值                       |
  | array_diff      | 计算数组的差集                           |
  | array_intersect | 计算数组的交集                           |
  | array_merge     | 合并一个或多个数组                       |
  | array_shift     | 将数组开头的单元移出数组                 |
  | array_unshift   | 在数组开头插入一个或多个单元             |
  | array_pop       | 弹出数组最后一个单元（出栈）             |
  | array_push      | 将一个或多个单元压入数组的末尾（入栈）   |

## 正则表达式🏆

分割、查找、匹配、替换字符串

### 常用函数

- preg_match($pattern, $subject);

  preg_match_all($pattern, $subject, array &$matches);

  preg_replace($pattern, $replacement, $subject);

  preg_filter($pattern, $replacement, $subject);

  preg_grep($pattern, array $input);

  preg_split($pattern, $subject);

  preg_quote($str);

- 定义一个打印函数

```php
function show($var){
    if(empty($var)){
        echo 'null';
    }elseif(is_array($var)||is_object($var)){
        echo '<pre>';
        print_r($var);
        echo '</pre>'
    }else{
        echo $var;
    }
}
```

### 函数实例

- preg_match()与preg_match_all() 都是**引用传递**：直接放到结果数组中

| preg_match                         | preg_match_all                     |
| ---------------------------------- | ---------------------------------- |
| 只匹配一次，返回匹配次数，一位数组 | 匹配所有，也返回匹配次数，二维数组 |

```php
$pattern = '/[0-9]/';
$subject = 'wdasd21sda4g8kb3';

$m1 = $m2 = array();

preg_match($pattern, $subject, $m1);//返回1 m1=[2]
preg_match_all($pattern, $subject, $m2);//返回5 $m2=[2,1,4,8,3]
```



- preg_replace和preg_filter

  | preg_replace                       | preg_filter                          |
  | ---------------------------------- | ------------------------------------ |
  | 可以在字符串、数组中替换，返回所有 | 在数组中匹配时只返回发送替换到的地方 |

  ```php
  $pattern = '/[0-9]/';
  $subject = 'wdasd21sda4g8kb3';
  $replacement = '数'
  
  $str1 = preg_replace($pattern, $replacement, $subject);
  $str2 = preg_filter($pattern,$replacement, $subject);
  ```

  

- preg_grep

  阉割filter的替换   只返回发生匹配的地方

  ```php
  $pattern = '/[0-9]/';
  $array = ['wdas','d21s','da4g','8kb3'];
  
  $res = preg_grep($pattern, $array);
  /*[1] => d21s
    [2] => da4g
    [3] => 8kb3*/
  ```

  

- preg_split

  以匹配模式分割字符串

  ```php
  $pattern = '/[0-9]/';
  $str = 'wdasd21sda4g8kb3';
  
  $res = preg_split($pattern, $str);
  ```

  explode 可以看作是该函数的子集

  

- preg_quote

  正则运算符转义 自动加上'\\'

  

### 语法

- 界定符

  表示一个正则表达式的开始和结束 /[0-9]/ php编译规定`/`作为界定符

  

- 原子 

  不可见原子 Unicode编码表中用键盘输出后肉眼不可见的字符

  - 换行符\n
    回车\r
    制表符\t
    空格
  - 可以用转换器转换中文为Unicode 再匹配

  

- 元字符

  定义原子的筛选方式

  | 字符 | 含义                                |
  | ---- | ----------------------------------- |
  | \|   | 匹配两个或者多个分支选择;           |
  | []   | 匹配方括号中的任意一个原子;         |
  | [^]  | 匹配除方括号中的原子之外的任意字符; |

  - 原子的集合

  | 字符 | 含义                                                 |
  | ---- | ---------------------------------------------------- |
  | .    | 匹配除换行符之外的任意字符                           |
  | \d   | 匹配任意一个十进制数字，即[0-9]                      |
  | \D   | 匹配任意一个非十进制数字，即\[^0-9]                  |
  | \s   | 匹配一个不可见原子，即[\f\n\r\t\v]                   |
  | \S   | 匹配一个可见原子，即\[^\f\n\r\t\v]                   |
  | \w   | 匹配任意一个数字、字母或下划线，即[0-9a-zA-Z. ]      |
  | \W   | 匹配任意一个非数字、字母或下划线，即\[^0-9a-zA-Z_ ]; |

  

- 量词

  | 符号  | 含义                                       |
  | ----- | ------------------------------------------ |
  | {n}   | 表示其前面的原子恰好出现n次                |
  | {n,}  | 表示其前面的原子最少出现n次                |
  | {n,m} | 表示其前面的原子最少出现n次，最多出现m次   |
  | *     | 匹配0次、1次或者多次其之前的原子，即{0,} ; |
  | +     | 匹配1次或者多次其之前的原子，即{1,}        |
  | ？    | 匹配0次或者1次其之前的原子，即{0,1}        |

  

- 边界控制与模式单元

  | 符号 | 含义                     |
  | ---- | ------------------------ |
  | ^    | 匹配输入字符串开始的位置 |
  | $    | 匹配输入字符串结尾的位置 |
  | ()   | 匹配其中的整体为一个原子 |



  

### 修正模式

默认为贪婪模式

|     贪婪匹配/[0-9]/      |    懒惰匹配 /[0-9]/U     |
| :----------------------: | :----------------------: |
| 匹配结果存在歧义时取其长 | 匹配结果存在歧义时取其短 |

- 常见修正模式

  | 模式修正符 |               对应模式                |
  | :--------: | :-----------------------------------: |
  |     U      |                 懒惰                  |
  |     u      |                 贪婪                  |
  |     i      |          忽略英文字母大小写           |
  |     x      |               忽略空白                |
  |     s      | 让元字符`.`匹配包括换行符在内所有字符 |
  |     e      |                                       |



### 常用正则表达式书写

​	

| 表达式                          | 含义      |
| ------------------------------- | --------- |
| .+                              | 非空      |
| \d+\\.\\d{2}$                   | 浮点数    |
| ^1[34578]\d{9}$                 | 手机号    |
| ^\w+(\\.\w+)*@\w+\\.[a-zA-Z]+$  | email地址 |
| ^(https?://)?(\w\\.)+(\\.\w+)*$ | URL匹配   |



### 中文匹配

## 文件及目录处理

### 文件读取/写入操作

- fopen — 打开文件或者 URL ,需要指定打开模式

  | mode | 说明                                                 |
  | ---- | ---------------------------------------------------- |
  | r    | 只读方式打开，将文件指针指向文件头。                 |
  | r+   | 读写方式打开，将文件指针指向文件头。                 |
  | w    | 写入方式打开，将文件指针指向文件头并将文件大小截为零 |
  | w+   | 写入方式打开，将文件指针指向文件头并将文件大小截为零 |
  | x    | 写入方式打开,将文件指针指向文件末尾。                |
  | x+   | 读写方式打开，将文件指针指向文件末尾。               |

  

- 函数列

  | 功能                | 函数              | 说明                               |
  | ------------------- | ----------------- | ---------------------------------- |
  | 打开文件            | fopen             | 打开文件或者 URL ,需要指定打开模式 |
  | 写入函数            | fwrite            | 写入文件（可安全用于二进制文件）   |
  | 读取函数            | fread             | 读取文件（可安全用于二进制文件）   |
  |                     | fgets             | 从文件指针中读取一行               |
  |                     | fgetc             | 从文件指针中读取字符               |
  | 关闭文件函数        | fclose            | 关闭一个已打开的文件指针           |
  | 不需要fopen()的函数 | file_put_contents | 将一个字符串写入文件               |
  |                     | file_get_contents | 整个文件读入一个字符串             |
  | 其他读取函数        | file              | 把整个文件读入一个数组中           |
  |                     | readfile          | 输出文件                           |

### 目录操作函数、其他文件操作

| 功能     | 函数                                             |
| -------- | ------------------------------------------------ |
| 名称相关 | basename()、dirname()、 pathinfo()               |
| 目录读取 | opendir()、readdir()、 closedir()、 rewinddir()  |
| 目录删除 | rmdir()                                          |
| 目录创建 | mkdir()                                          |
| 文件大小 | filesize()                                       |
| 目录大小 | disk_free_space()、 disk_total_space()           |
| 文件拷贝 | copy()                                           |
| 删除文件 | unlink()                                         |
| 文件类型 | filetype()                                       |
| 重命名   | rename()                                         |
| 文件截取 | ftruncate()                                      |
| 文件属性 | file_exists()、 is__readable()、is_ _writable(). |
| 文件锁   | flock()                                          |
| 文件指针 | ftell()、fseek()、rewind()                       |



## 会话控制

### 为啥需要会话控制

- 如果只通过GET传递：产生安全、参数丢失问题

-  HTTP是无状态的，**没有内建机制来保存状态**，请求会被隔离，无法保持用户状态

### 会话控制技术

|      | cookie                                       | session                                                      |
| ---- | -------------------------------------------- | ------------------------------------------------------------ |
| 区别 | 存储在客户端                                 | 基于cookie，存储在服务器                                     |
| 操作 | 设置：setcookie($name,$value,$expire);       | 设置：session_start()                                        |
|      | 读取：$_COOKIE                               | 读取：$_SESSION                                              |
|      | 删除：setcookie($name, ", time())-1000);     | 删除：unset()                                                |
|      |                                              | 配置<br />session.auto_start<br/>session.cookie_domain<br/>session.cookie_lifetime<br/>session.cookie_ path<br/>session.name<br/>session.save_path<br/>session.use_cookies<br/>session.use_trans\_ sid |
| 优点 | 不会占用服务器资源，不会浪费                 | 安全                                                         |
| 缺点 | 有安全问题，信息保存在客户端，用户也可以禁用 | 占用服务器资源、分布式                                       |

- 传递SessionID的问题

	- session_name()
	- session_id()
- session存储

	- 不要存储在文件中，应该存储在内存服务器中
	- 函数session_set_save_handle()
	- MySQL、Memcache、Redis等

## 面向对象

### 类权限控制修饰符

| 类权限控制修饰符 | 作用                                                         |
| ---------------- | :----------------------------------------------------------- |
| public           | 可以在类的内部、外部使用、供子类使用<br />**一般配合static提供给外部接口，不用实例化就可以使用**😎 |
| protected        | 可以在类的内部使用、子类使用、可以继承但是不能在类的外部使用 |
| private          | 只能在类的内部使用、不能被继承                               |

### 面向对象的封装、继承和多态

|      | 实现                                           | 备注                                                         |
| ---- | ---------------------------------------------- | ------------------------------------------------------------ |
| 封装 | 成员访问权限                                   | 封装是指将现实世界中存在的某个客体的属性与行为绑定在一起，并放置在一个逻辑单元内 |
| 继承 | PHP的继承为**单一继承**👑即同时只能继承一个父类 | 子类拥有与父类同名方法会进行**覆盖**🔂                        |
| 多态 | 抽象类                                         | 1. 任何一个类，如果它里面至少有一个方法是被声明为抽象的，那么整个类就必须被声明为抽象的 |
|      |                                                | 2. 定义为抽象的类**不能被实例化**                            |
|      |                                                | 3. 被定义为抽象的方法只是声明了其调用方式（参数），不能定义其具体的功能实现 |
|      |                                                | 4. 继承一个抽象类的时候，**子类必须定义父类中的所有抽象方法**👐 |
|      | 接口🖨                                          | 1. 要实现一个接口，使用 implements 操作符                    |
|      |                                                | 2. 使用接口（interface），可以指定某个类必须实现哪些方法，但不需要定义这些方法的具体内容 |
|      |                                                | 3. 接口是通过 interface 关键字来定义的，就像定义一个标准的类一样，但其中定义所有的方法都是空的 |
|      |                                                | 4 .接口中定义的所有方法都必须是公有，这是接口的特性          |



### 魔术方法🎠

| 函数           | 用途                                         |
| -------------- | -------------------------------------------- |
| __construct()  | 类的构造函数 <u>方法名和类名一致就是构造</u> |
| __destruct()   | 类的析构函数                                 |
| __call()       | 在对象中调用一个不可访问方法时调用           |
| __callStatic() | 用静态方式中调用一个不可访问方法时调用       |
| __get()        | 获得一个类的成员变量时调用                   |
| __set()        | 设置一个类的成员变量时调用                   |
| __isset()      | 当对不可访问属性调用isset()或empty()时调用   |
| __unset()      | 当对不可访问属性调用unset()时被调用          |
| __clone()      | 当对象复制完成时调用                         |
| __autoload()   | 尝试加载未定义的类                           |
| __toString()   | 类被当成字符串时的回应方法                   |
| __debugInfo()  | 打印所需调试信息                             |



### 设计模式

| 设计模式   | 特点                                                         |
| ---------- | ------------------------------------------------------------ |
| 工厂模式   | 定义一个专门用来创建其它对象的类，调用时不用new              |
| 单例模式   | 可用于数据库创建，只允许new一个数据库类，减少资源的浪费      |
| 注册树模式 | 已经创建好对象后，将其注册到全局书上，这样可以直接访问       |
| 适配器模式 | 可以将截然不同的函数接口封装成统一的API                      |
| 策略模式   | 将一组特定的行为和算法封装成类，以适应某些特定的上下文环境   |
| 观察者模式 | 当一个对象状态发生改变时，依赖它的对象全部会收到通知，并自动更新 |



## 开发环境及配置

### 版本控制软件

- 集中式

	- 版本上传到中央服务器
	- CVS和SVN

- 分布式

	- Git

### PHP运行原理 Nginx+PHP-FPM

- CGI协议  PHP解析器 与webserver通讯、联系的一个协议
- FastCGI 是CGI的改良版本 可以保留进程
- PHP-FPM 是FastCGI的进程管理器

### PHP常见配置项

| 配置项              | 功能                     |
| ------------------- | ------------------------ |
| register_globals    | 注册全局变量             |
| allow_url_fopen     | 允许远程文件打开         |
| allow_url_include   | 允许远程文件包含         |
| date_timezone       | 设置时区                 |
| display_errors      | 显示错误，生产环境下关掉 |
| error_reporting     | 错误级别设置             |
| safe_mode           | 安全模式                 |
| upload_max_filesize | 上传最大文件大小         |
| max_file_uploads    | 文件数目                 |
| post_max_size       | post数据大小             |

