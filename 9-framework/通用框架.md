### æ¡†æ¶è¿è¡Œæµç¨‹

![image-20200604132947309](https://i.loli.net/2020/06/04/ZW78zMs5yQOdgem.png)

### å…¥å£æ–‡ä»¶

1. å®šä¹‰ç³»ç»Ÿå¸¸é‡

   ```php
   define('ROOT',realpath('.'));
   define('CORE',ROOT.'/core');
   define('APP',ROOT.'/app');
   
   define('DEBUG',true);
   
   if(DEBUG){
       ini_set('display_errors','On');
   }else{
       ini_set('display_errors','Off');
   }
   ```

2. åŠ è½½å‡½æ•°åº“

   ```php
   include CORE.'/common/function.php';
   include CORE.'/mvc.php'
   ```

3. å¯åŠ¨æ¡†æ¶

   ```php
   //å‘½åç©ºé—´
   \core\mvc::run();
   ```

### ç±»è‡ªåŠ¨åŠ è½½

- å…¥å£æ–‡ä»¶

```php
spl_autoload_register('mvc::load');
```

- è‡ªåŠ¨åŠ è½½æ ¸å¿ƒ

  å®é™…å°±æ˜¯å°±æ˜¯å¼•å…¥å¯¹åº”æ–‡ä»¶

```php
namespace core;

class mvc{
    //å­˜å‚¨ç±» æå‡æ€§èƒ½
	public static $classMap = array();
	//è‡ªåŠ¨åŠ è½½ç±»
    //new \core\route();
    //$class = '\core\route'; //ç±»å‘½åç©ºé—´
    //ROOT.'/core/route.php'; //è‡ªåŠ¨è·¯å¾„
	public static function load($class){
        if(isset($classMap[$class])){
            return true;
        }
		$class = '/'.str_replace('\\','/',$class);
        $file = ROOT.$class.'.php';
        if(is_file($file)){
            include $file;//åŠ è½½
            self::$classMap[$class] = $class;
        }else{
            return false;
        }
}
```

### è·¯ç”±

- å®è´¨å°±æ˜¯é€šè¿‡index.phpå¤„ç†æ‰€æœ‰URLä¿¡æ¯

  xxx.com/index/index è¾“å…¥
  xxx.com/index.php/index/index çœŸæ­£è®¿é—®

1. éšè—index.php

   nginxå’Œapacheå¯¹åº”ä¸åŒæ–¹æ³•

2. è·å–URL å‚æ•°éƒ¨åˆ†

   ```php
   public $ctrl;//æ§åˆ¶å™¨
   public $action;//æ–¹æ³•
   
   public function __construct(){
       //å¦‚æœå­˜åœ¨URL
       if(isset($_SERVER['REQUEST_URI'])
           &&$_SERVER['REQUEST_URI']!='/'){
           $path = $_SERVER['REQUEST_URI'];//è·å¾—/index/index
           //å¤„ç†URLå‚æ•°ä¸ºæ•°ç»„
           $pathArr = explode('/',trim($path,'/'));
           if(isset($pathArr[0])){
               $this->ctrl = $pathArr[0];
           }
           if(isset($pathArr[1])){
               $this->action = $pathArr[1];
           }else{
               $this->action='index';
           }
           //åé¢å¤„ç†ä¸ºGET
       }else{//é»˜è®¤è·¯å¾„
           $this->ctrl='index';
           $this->action='index';
       }
   }
   ```

3. è¿”å›å¯¹åº”æ§åˆ¶å™¨å’Œæ–¹æ³•

   ```php
   $this->ctrl='index';
   $this->action='index';
   ```

   

### åŠ è½½æ§åˆ¶å™¨

â€‹	å°±æ˜¯ç”¨è·¯ç”±ä¼ è¿‡æ¥çš„URLæ‹¼æ¥ å¹¶å¼•å…¥æ§åˆ¶å™¨æ–‡ä»¶

```php
class mvc
{
    public static function run(){
        $route = new route();
        $ctrlClass = $route->ctrl;//æ§åˆ¶å™¨
        $action =$route->action;
        $ctrlPath = APP.'/ctrl/'.$ctrlClass.'php';
        if(is_file($ctrlPath)){
            include $ctrlPath;
            new APP.'/ctrl/'.$ctrlClass();
        }else{
            throw new \Exception('æ‰¾ä¸åˆ°æ§åˆ¶å™¨');
        }
    }
```

### æ¨¡å‹

- æ¨¡å‹è¿æ¥æ•°æ®åº“ğŸ“¦ ç»§æ‰¿PDO

  ```php
  class model extends \PDO
  {
      public function __construct(){
          try{
              $dsn = 'mysql:host=localhost;dbname=test';
              $username = 'root';
              $passwd = 'root';
          }catch (\PDOException $e){
              p($e->getMessage());
          }
      }
  }
  ```

- æ§åˆ¶å™¨å®ä¾‹åŒ–å³å¯

  ```php
  $model = new model();
  $sql = "select * from table";
  $model->query($sql);
  ```

### è§†å›¾

- æ ¸å¿ƒæ–‡ä»¶åŒ…å«è¯¥æ–¹æ³•

  ```php
  public function assign($name,$value){
  	$this->assign[$name]=$value;
  }
  //å‘ˆç°è§†å›¾æ–‡ä»¶
  public function display($file){
  	$file = APP.'/view'.$file;
      if(is_file($file)){
      	include $file;//å³å¯æ˜¾ç¤ºè§†å›¾
      }
  }
  ```

- æ§åˆ¶å™¨

  ```php
  class indexCtrl extends mvc
  {
      public function index(){
          $data = 'hello world';
          $this->assign('data',$data);
          $this->display('index/index.html');
      }
  }
  ```

  

### é…ç½®ç±»

- å»ºç«‹é…ç½®æ–‡ä»¶ route.php

  ```php
  return [
  	'ctrl'=> 'index',
  	'action'=> 'display',
  ];
  ```

- é…ç½®class

  ```php
  class config
  {
      static public $conf = array();
      //    1åˆ¤æ–­é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
      //    2åˆ¤æ–­é…ç½®æ˜¯å¦å­˜åœ¨
      //    3ç¼“å­˜é…ç½®
      static public function get($name,$file)
      {   //
          $file = ROOT.'\core\config\\'.$file.'.php';
          if (is_file($file)) {
              $conf = include $file;//åŠ è½½æ–‡ä»¶
              if (isset($conf[$name])) {
                  self::$conf[$file] = $conf;
                  return $conf[$name];
              } else {
                  throw new \Exception('æ²¡æœ‰è¿™ä¸ªé…ç½®é¡¹' . $name);
              }
          } else {
              throw new \Exception('æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶' . $file);
          }
      }
  }
  ```

- ä½¿ç”¨

  ```php
  config::get('ctrl','route')
  ```

  

### composeråŠ è½½

- æ–°å»ºcomposer.json 

  ```json
  {
   "name":" IMOOC PHP",
   "description": "PHP Framework",
   "type" :"Framework",
   "keywords":[
  	"PHP"ï¼Œ "PHP Framework"
   ],
   "require":{ //ä¾èµ–
  	"php":">= 5.3.0" ,
      "filp/whoops":"*",//è¦ä¸‹è½½çš„é”™è¯¯å¤„ç†ç±»
      "symfony/var-dumper" :"*"//è¦ä¸‹è½½çš„ç±»
  }
  
  ```

  ```shell
  $ composer install #ç¬¬ä¸€æ¬¡
  $ composer update #ä»¥åè¦åŠ è½½å…¶ä»–ç±»åº“æ—¶
  ```

  